<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>GGpang</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="USE day15;UNION 语句：用于将不同表中相同列中查询的数据展示出来；（不包括重复数据） UNION ALL 语句：用于将不同表中相同列中查询的数据展示出来；（包括重复数据） 1SELECT 列名称 FROM 表名称 UNION SELECT 列名称 FROM 表名称 ORDER BY 列名称； 1SELECT 列名称 FROM 表名称 UNION ALL SELECT 列名称 FROM">
<meta property="og:type" content="article">
<meta property="og:title" content="GGpang">
<meta property="og:url" content="http://yoursite.com/2019/05/20/ggman/index.html">
<meta property="og:site_name" content="GGpang">
<meta property="og:description" content="USE day15;UNION 语句：用于将不同表中相同列中查询的数据展示出来；（不包括重复数据） UNION ALL 语句：用于将不同表中相同列中查询的数据展示出来；（包括重复数据） 1SELECT 列名称 FROM 表名称 UNION SELECT 列名称 FROM 表名称 ORDER BY 列名称； 1SELECT 列名称 FROM 表名称 UNION ALL SELECT 列名称 FROM">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-05-20T06:58:05.695Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="GGpang">
<meta name="twitter:description" content="USE day15;UNION 语句：用于将不同表中相同列中查询的数据展示出来；（不包括重复数据） UNION ALL 语句：用于将不同表中相同列中查询的数据展示出来；（包括重复数据） 1SELECT 列名称 FROM 表名称 UNION SELECT 列名称 FROM 表名称 ORDER BY 列名称； 1SELECT 列名称 FROM 表名称 UNION ALL SELECT 列名称 FROM">
  
    <link rel="alternate" href="/atom.xml" title="GGpang" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">GGpang</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-ggman" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/20/ggman/" class="article-date">
  <time datetime="2019-05-20T06:58:05.000Z" itemprop="datePublished">2019-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="USE-day15"><a href="#USE-day15" class="headerlink" title="USE day15;"></a>USE day15;</h4><p><strong>UNION 语句</strong>：用于将不同表中相同列中查询的数据展示出来；（不包括重复数据）</p>
<p><strong>UNION ALL 语句</strong>：用于将不同表中相同列中查询的数据展示出来；（包括重复数据）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 列名称 FROM 表名称 UNION SELECT 列名称 FROM 表名称 ORDER BY 列名称；</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 列名称 FROM 表名称 UNION ALL SELECT 列名称 FROM 表名称 ORDER BY 列名称；</span><br></pre></td></tr></table></figure>
<p>将两张不同表中的相同字段全部展现出来</p>
<h4 id="–-一、数据约束"><a href="#–-一、数据约束" class="headerlink" title="– 一、数据约束"></a>– 一、数据约束</h4><p>– 1.1 默认值(default)<br>CREATE TABLE test(</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NAME VARCHAR(20),</span><br><span class="line">gender VARCHAR(2) DEFAULT &apos;男&apos;</span><br></pre></td></tr></table></figure>
<p>)</p>
<p>INSERT INTO test(NAME) VALUES(‘张三’);<br>INSERT INTO test(NAME,gender) VALUES(‘张三’,NULL);</p>
<p>SELECT * FROM test;</p>
<p>– 需求：当不插入gender的时候，分配一个‘男’的默认值<br>– 注意： 1）当没有插入gender字段的时候，分配一个默认值</p>
<p>– 1.2 非空（not null）<br>CREATE TABLE test(<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NAME VARCHAR(20) NOT NULL,</span><br><span class="line">gender VARCHAR(2)</span><br></pre></td></tr></table></figure></p>
<p>)<br>– 需求： name字段一定要有值（不能不插入数据，不能是null），这是给name添加非空约束<br>– 1)非空约束，不能不插入值<br>INSERT INTO test(gender) VALUES(‘男’); – ERROR 1364 (HY000): Field ‘NAME’ doesn’t have a default value</p>
<p>– 2)非空约束，不能插入null<br>INSERT INTO test(NAME,gender) VALUES(NULL,’男’); – ERROR 1048 (23000): Column ‘NAME’ cannot be null</p>
<p>– 1.3 唯一约束（unique）</p>
<p>CREATE TABLE test(<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id INT UNIQUE,</span><br><span class="line">NAME VARCHAR(20)</span><br></pre></td></tr></table></figure></p>
<p>)<br>– 需求： id的值不能出现重复值。这时就要给id添加一个唯一约束。<br>INSERT INTO test(id,NAME) VALUES(1,’张三’);<br>– 1)不能插入重复的值<br>INSERT INTO test(id,NAME) VALUES(1,’李四’); – Duplicate entry ‘1’ for key ‘id’<br>INSERT INTO test(id,NAME) VALUES(2,’李四’);<br>– 2)唯一约束，可以插入多个null。所以唯一约束不能约束null<br>INSERT INTO test(id,NAME) VALUES(NULL,’王五’);<br>INSERT INTO test(id,NAME) VALUES(NULL,’陈六’);</p>
<p>– 1.4 主键约束(primary key)（唯一+非空）<br>– 注意：<br>– 1）通常情况下，我们会给每张表都会设置一个主键字段，用来标记记录的唯一性<br>– 2）但是不建议把业务含义字段作为主键，因为随着业务的变化，业务字段可能会出现重复。<br>– 3）建议给每张张独立添加一个叫id的字段，把这个id字段设置成主键，用来作为记录的唯一性。</p>
<p>CREATE TABLE test(<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id INT PRIMARY KEY,</span><br><span class="line">NAME VARCHAR(20)</span><br></pre></td></tr></table></figure></p>
<p>)</p>
<p>– 1)唯一性<br>INSERT INTO test(id,NAME) VALUES(1,’张三’);<br>INSERT INTO test(id,NAME) VALUES(1,’张三’); – Duplicate entry ‘1’ for key ‘PRIMARY’</p>
<p>– 2）非空性<br>INSERT INTO test(id,NAME) VALUES(NULL,’张三’); – ERROR 1048 (23000): Column ‘id’ cannot be null</p>
<p>– 1.5 自增长约束（auto_increment）</p>
<p>CREATE TABLE test(<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">NAME VARCHAR(20)</span><br></pre></td></tr></table></figure></p>
<p>)<br>– 自增长约束：初始值为0，每次递增1<br>– 需求：id的值不需要我们开发者管理，交给数据库维护，这时给id添加自增长约束。<br>INSERT INTO test(NAME) VALUES(‘张三’);<br>INSERT INTO test(NAME) VALUES(‘李四’);<br>INSERT INTO test(NAME) VALUES(‘王五’);</p>
<p>– 删除数据<br>– delete from test where id=2;<br>– 使用truncate table删除数据的时候，可以把自增长的初始值置为0<br>TRUNCATE TABLE test;</p>
<p>SELECT * FROM test;</p>
<p>– 1.6 外键约束<br>– 外键作用： 约束两种表的数据<br>– 问题： 约束哪种情况下的两种表呢？<br>– 员工表<br>CREATE TABLE employee(<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">NAME VARCHAR(20),</span><br><span class="line">deptName VARCHAR(20)</span><br></pre></td></tr></table></figure></p>
<p>)</p>
<p>INSERT INTO employee(NAME,deptName) VALUES(‘张三’,’软件开发部’);<br>INSERT INTO employee(NAME,deptName) VALUES(‘李四’,’软件维护部’);<br>INSERT INTO employee(NAME,deptName) VALUES(‘王五’,’软件开发部’);<br>INSERT INTO employee(NAME,deptName) VALUES(‘陈六’,’软件开发部’);</p>
<p>– 问题：每次插入员工数据时，部门名称数据会出现重复（冗余）,如果数据出现冗余，那么会浪费数据库存储空间。<br>– 如何解决部门名称数据冗余的问题? 这时就可以设计一张独立的 部门表，把部门名称放到部门表中。</p>
<p>– 员工表<br>CREATE TABLE employee(<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">NAME VARCHAR(20),</span><br><span class="line">deptId INT</span><br></pre></td></tr></table></figure></p>
<p>)</p>
<p>– 部门表<br>CREATE TABLE dept(<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">NAME VARCHAR(20)</span><br></pre></td></tr></table></figure></p>
<p>)</p>
<p>SELECT <em> FROM employee;<br>SELECT </em> FROM dept;</p>
<p>INSERT INTO dept(NAME) VALUES(‘软件开发部’);<br>INSERT INTO dept(NAME) VALUES(‘软件维护部’);<br>INSERT INTO employee(NAME,deptId) VALUES(‘陈六’,1);<br>INSERT INTO employee(NAME,deptId) VALUES(‘王五’,1);</p>
<p>INSERT INTO employee(NAME,deptId) VALUES(‘张三’,3); – 问题：在插入员工表的部门id的时候，插入了不存在的部门id，如何防止这种非法数据的插入，这时就添加外键约束了。</p>
<p>– 添加外键约束（foreign key）<br>– 需求：deptId字段值来自于dept表的id字段的值，这时可以给deptId字段添加外键约束。<br>– 员工表（副表： 被别的表约束。外键设置在副表）<br>CREATE TABLE employee(<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">NAME VARCHAR(20),</span><br><span class="line">deptId INT,</span><br><span class="line">CONSTRAINT employee_dept_fk FOREIGN KEY(deptId) REFERENCES dept(id)</span><br><span class="line">--          外键名称                     外键字段  参考</span><br></pre></td></tr></table></figure></p>
<p>)</p>
<p>– 部门表（主表：约束别人的表）<br>CREATE TABLE dept(<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">NAME VARCHAR(20)</span><br></pre></td></tr></table></figure></p>
<p>)</p>
<p>SELECT <em> FROM employee;<br>SELECT </em> FROM dept;</p>
<p>INSERT INTO employee(NAME,deptId) VALUES(‘陈六’,1);<br>INSERT INTO employee(NAME,deptId) VALUES(‘王五’,1);<br>– 插入数据<br>INSERT INTO employee(NAME,deptId) VALUES(‘张三’,3); – 违反外键约束：a foreign key constraint fails<br>– 修改数据<br>UPDATE employee SET deptId=5 WHERE id=2; – a foreign key constraint fails<br>– 删除数据<br>DELETE FROM dept WHERE id=1; – a foreign key constraint fails</p>
<p>– 外键约束在什么情况下，会其作用？<br>– 插入数据：当往副表插入了主表不存在的数据时，外键起作用<br>– 修改数据：当往副表修改为主表不存在的数据时，外键起作用<br>– 删除数据: 副表中有关联主表的数据的时候，当删除主表数据，外键其作用</p>
<p>– 当有了外键之后，应该如何管理数据呢？<br>– 插入数据： 先插入主表的数据，再插入副表数据<br>– 修改数据： 先修改主表数据，再修改副表数据<br>UPDATE employee SET deptId=3 WHERE id=5;<br>UPDATE dept SET id=3 WHERE id=2;<br>– 删除数据：先删除副表数据，再删除主表数据<br>DELETE FROM dept WHERE id=3;<br>DELETE FROM employee WHERE deptId=3;</p>
<p>– 1.8 级联操作(CASCADE)<br>– 员工表（副表： 被别的表约束。外键设置在副表）<br>DROP TABLE employee;<br>CREATE TABLE employee(<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">NAME VARCHAR(20),</span><br><span class="line">deptId INT,</span><br><span class="line">-- 添加级联修改： ON UPDATE CASCADE</span><br><span class="line">-- 添加级联删除： ON DELETE CASCADE </span><br><span class="line">CONSTRAINT employee_dept_fk FOREIGN KEY(deptId) REFERENCES dept(id) ON UPDATE CASCADE ON DELETE CASCADE </span><br><span class="line">--          外键名称                     外键字段  参考</span><br></pre></td></tr></table></figure></p>
<p>)</p>
<p>– 部门表（主表：约束别人的表）<br>CREATE TABLE dept(<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">NAME VARCHAR(20)</span><br></pre></td></tr></table></figure></p>
<p>)</p>
<p>SELECT <em> FROM employee;<br>SELECT </em> FROM dept;<br>INSERT INTO employee(NAME,deptId) VALUES(‘陈六’,2);<br>INSERT INTO employee(NAME,deptId) VALUES(‘王五’,2);</p>
<p>– 只修改部门<br>UPDATE dept SET id=1 WHERE id=2;<br>– 只删除部门<br>DELETE FROM dept WHERE id=1;</p>
<p>– 二、多表查询<br>TRUNCATE TABLE dept;<br>DELETE FROM dept;<br>TRUNCATE TABLE employee;</p>
<p>INSERT INTO dept(NAME) VALUES(‘软件开发部’);<br>INSERT INTO dept(NAME) VALUES(‘软件维护部’);<br>INSERT INTO dept(NAME) VALUES(‘秘书部’);</p>
<p>INSERT INTO employee(NAME,deptId) VALUES(‘张三’,4);<br>INSERT INTO employee(NAME,deptId) VALUES(‘李四’,5);<br>INSERT INTO employee(NAME,deptId) VALUES(‘王五’,4);</p>
<p>INSERT INTO employee(NAME,deptId) VALUES(‘陈六’,5);</p>
<p>– 1.1 交叉连接查询（笛卡尔乘积: 4*3=12，产生笛卡尔积的原因是没有足够的连接条件）<br>– 需求： 员工及其部门<br>SELECT employee.name,dept.name FROM employee,dept;</p>
<p>– 多表查询的步骤： 1）确定查询哪些表  2）确定查询哪些字段  3）确定连接条件(规则： 表数量-1)<br>– 内连接效果：只有满足连接条件的数据才会显示出来<br>– 1.2 内连接查询（使用最多）<br>SELECT e.name,d.name<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM employee e,dept d</span><br><span class="line">WHERE e.deptId=d.id;</span><br></pre></td></tr></table></figure></p>
<p>– 另一种语法<br>SELECT e.name,d.name<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM employee e</span><br><span class="line">INNER JOIN dept d</span><br><span class="line">ON e.deptId=d.id;</span><br></pre></td></tr></table></figure></p>
<p>INNER JOIN（内联）：两个表a,b 相连接，取出符合连接条件的字段</p>
<p>– 1.3 左外连接查询（其次）<br>– 需求： 查询部门及其部门的员工（部门全部显示）<br>– 左外连接查询效果： 左表（部门表）的数据全部显示，右表（员工）的数据当满足连接条件的时候，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-- 就显示满足条件的的数据，但是如果不满足连接条件，则显示null</span><br></pre></td></tr></table></figure>
<p>– 预期结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 软件开发部  张三</span><br><span class="line">-- 软件开发部  王五</span><br><span class="line">-- 软件维护部  李四</span><br><span class="line">-- 软件维护部  陈六</span><br><span class="line">-- 秘书部      null</span><br></pre></td></tr></table></figure></p>
<p>SELECT d.name,e.name<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM dept d</span><br><span class="line">LEFT OUTER JOIN employee e</span><br><span class="line">ON d.id=e.deptId;</span><br></pre></td></tr></table></figure></p>
<p>LEFT JOIN（左联）：先返回左表的所有行，再加上符合连接条件的匹配行</p>
<p>– 1.4 右外连接查询<br>– 右外连接查询效果： 右表（部门表）的数据全部显示，左表（员工）的数据当满足连接条件的时候，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-- 就显示满足条件的数据，但是如果不满足连接条件，则显示null</span><br></pre></td></tr></table></figure>
<p>SELECT d.name,e.name<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM employee e</span><br><span class="line">RIGHT OUTER JOIN dept d</span><br><span class="line">ON d.id=e.deptId;</span><br></pre></td></tr></table></figure></p>
<p>RIGHT JOIN（右联）：先返回右表的所有行，再加上符合连接条件的匹配行</p>
<p>– 1.5 自连接查询<br>– 需求： 查询员工姓名及其上司姓名(没有上司的员工也显示)<br>– 预期结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">       员工    上司</span><br><span class="line">-- 张三   null</span><br><span class="line">-- 李四   张三</span><br><span class="line">-- 王五   李四</span><br><span class="line">-- 陈六   王五</span><br></pre></td></tr></table></figure>
<p>SELECT e.name AS ‘员工’,b.name AS ‘上司’<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM employee e</span><br><span class="line">LEFT OUTER JOIN employee b</span><br><span class="line">ON e.bossId=b.id;</span><br></pre></td></tr></table></figure></p>
<p>– 三，mysql存储过程<br>– 创建存储过程<br>– 定义结束符号<br>DELIMITER $<br>CREATE PROCEDURE pro_test()<br>BEGIN<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM employee;</span><br></pre></td></tr></table></figure></p>
<p>END $</p>
<p>– 调用存储过程<br>CALL pro_test();</p>
<p>– 3.1 带有输入参数的存储过程<br>– 需求： 传入员工id查询对应的员工<br>DELIMITER $<br>CREATE PROCEDURE pro_testByIn(IN eid INT)  – 参数类型（IN） 参数名称 数据类型(int)<br>BEGIN<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM employee WHERE id=eid;</span><br></pre></td></tr></table></figure></p>
<p>END $</p>
<p>– 调用<br>CALL pro_testByIn(2);</p>
<p>– 3.2 带有输出参数的存储过程<br>DELIMITER $<br>CREATE PROCEDURE pro_testByOut(OUT n VARCHAR(20))<br>BEGIN<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 修改变量n</span><br><span class="line">SET n = &apos;输出参数&apos;;</span><br></pre></td></tr></table></figure></p>
<p>END $</p>
<p>– 问题： 如何接收存储过程的输出参数？？？<br>– 定义变量去接收输出参数数据。</p>
<p>– mysql数据库三种变量：<br>    – 1）全局变量。mysql内置的变量，mysql程序关闭的时候全局变量才会失效！！<br>            – character_set_client: mysql接收的客户端的数据编码<br>            – character_set_results： mysql使用什么编码输出给客户端数据<br>            – 查看某个全局变量： select @@变量名<br>            – 修改某个全局变量： set @@变量名=值<br>    – 2) 会话变量。变量只在某次登录的会话中有效！退出连接，会话变量数据失效！！<br>        – 查看某个会话变量： select @变量名<br>            – 修改/定义某个会话变量： set @变量名=值<br>    – 3) 局部变量：在存储过程中定义的变量。存储过程结束局部变量失效！！<br>        – 查看某个局部变量： select 变量名<br>            – 修改某个局部变量： set 变量名=值<br>            – 定义某个局部变量： declare 变量名 数据类型;    </p>
<p>– 定义会话变量去接收输出参数数据<br>– set @n=’eric’;<br>CALL pro_testByOut(@n);<br>– 查看会话变量n<br>SELECT @n;</p>
<p>– 3.3 带有输入输出参数的存储过程<br>DELIMITER $<br>CREATE PROCEDURE pro_testByInOut(INOUT n VARCHAR(20))<br>BEGIN<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- 查看n变量</span><br><span class="line">SELECT n;</span><br><span class="line">-- 修改n变量</span><br><span class="line">SET n = &apos;500&apos;;</span><br></pre></td></tr></table></figure></p>
<p>END $</p>
<p>– 定义会话变量调用存储过程<br>SET @n=’100’;<br>CALL pro_testByInOut(@n);<br>– 查看n<br>SELECT @n;</p>
<p>– 3.4 带有判断条件的存储过程<br>– 需求： 输入一个num整数，num=1 ,输出‘星期一’,num=2,输出‘星期二’，num=3,输出‘星期三’，否则，输出‘错误参数’<br>DELIMITER $<br>CREATE PROCEDURE pro_testByIf(IN num INT,OUT str VARCHAR(20))<br>BEGIN<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">IF num=1 THEN</span><br><span class="line">	SET str = &apos;星期一&apos;;</span><br><span class="line">ELSEIF num= 2 THEN</span><br><span class="line">	SET str =&apos;星期二&apos;;</span><br><span class="line">ELSEIF num=3 THEN</span><br><span class="line">	SET str = &apos;星期三&apos;;</span><br><span class="line">ELSE</span><br><span class="line">	SET str = &apos;错误参数&apos;;</span><br><span class="line">END IF;</span><br></pre></td></tr></table></figure></p>
<p>END $</p>
<p>CALL pro_testByIf(5,@str);<br>SELECT @str;</p>
<p>– 3.5 带有循环条件的存储过程<br>– 需求： 输入一个num，计算从1到num的总和。<br>DELIMITER $<br>CREATE PROCEDURE pro_testByWhile(IN num INT,OUT score INT)<br>BEGIN<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-- int result =0;</span><br><span class="line">-- for(int i=1;i&lt;=100;i++)&#123;</span><br><span class="line">-- 	result += i;</span><br><span class="line">-- &#125;</span><br><span class="line"></span><br><span class="line">-- 定义局部变量</span><br><span class="line">DECLARE	i INT DEFAULT 1;</span><br><span class="line">DECLARE result INT DEFAULT 0;</span><br><span class="line">WHILE i&lt;=num DO</span><br><span class="line">	SET result = result + i;</span><br><span class="line">	SET i = i+1;</span><br><span class="line">END WHILE;</span><br><span class="line">SET score = result;</span><br></pre></td></tr></table></figure></p>
<p>END $</p>
<p>CALL pro_testByWhile(200,@score);<br>SELECT @score;</p>
<p>– 3.6 携带数据库的数据给输出参数(INTO)<br>– 需求： 传入员工id，查询对应的员工，输出员工姓名<br>DELIMITER $<br>CREATE PROCEDURE pro_testByData(IN eid INT,OUT sname VARCHAR(20))<br>BEGIN<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT NAME INTO sname FROM employee WHERE id=eid;</span><br></pre></td></tr></table></figure></p>
<p>END $</p>
<p>CALL pro_testByData(2,@sname);<br>SELECT @sname;</p>
<p>– 存储过程练习<br>在student表的数据基础上，设计一个存储过程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1）计算出所有学生的英语平均分</span><br><span class="line">2）</span><br><span class="line">	如果平均分，大于80分，且小于等于100分，输出&apos;优秀&apos;</span><br><span class="line">	如果平均分，大于等于60分，且小于等于80分，输出&apos;良好&apos;</span><br><span class="line">	如果平均分，小于60分，输出&apos;不及格&apos;</span><br></pre></td></tr></table></figure>
<p>USE day14;</p>
<p>SELECT * FROM student2;</p>
<p>DELIMITER $<br>CREATE PROCEDURE pro_testByAvg(OUT str VARCHAR(20),OUT tavg FLOAT)<br>BEGIN<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DECLARE savg FLOAT DEFAULT 0.0;</span><br><span class="line">SELECT AVG(english) INTO savg FROM student2;</span><br><span class="line">IF savg&gt;80 AND savg&lt;=100 THEN</span><br><span class="line">	SET str = &apos;优秀&apos;;</span><br><span class="line">ELSEIF savg&gt;=60 AND savg&lt;=80 THEN</span><br><span class="line">	SET str = &apos;良好&apos;;</span><br><span class="line">ELSE </span><br><span class="line">	SET str = &apos;不及格&apos;;</span><br><span class="line">END IF;</span><br><span class="line">SET tavg = savg;</span><br></pre></td></tr></table></figure></p>
<p>END $</p>
<p>– 删除存储过程<br>DROP PROCEDURE pro_testByAvg;</p>
<p>CALL pro_testByAvg(@str,@tavg);<br>SELECT  @str;<br>SELECT @tavg;</p>
<p>– 四、触发器<br>– 员工日志表<br>CREATE TABLE emp_log(<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">content VARCHAR(20)</span><br></pre></td></tr></table></figure></p>
<p>)</p>
<p>– 需求： 当往员工表插入一条数据时，往员工日志插入一条记录。<br>– 创建增加触发器<br>CREATE TRIGGER tri_empAdd AFTER INSERT ON employee FOR EACH ROW<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO emp_log(content) VALUES(&apos;员工被插入了一条记录&apos;);</span><br></pre></td></tr></table></figure></p>
<p>– 创建修改触发器<br>CREATE TRIGGER tri_empUpd AFTER UPDATE ON employee FOR EACH ROW<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO emp_log(content) VALUES(&apos;员工被修改了一条记录&apos;);</span><br></pre></td></tr></table></figure></p>
<p>– 创建删除触发器<br>CREATE TRIGGER tri_empDel AFTER DELETE ON employee FOR EACH ROW<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO emp_log(content) VALUES(&apos;员工被删除了一条记录&apos;);</span><br></pre></td></tr></table></figure></p>
<p>DROP TRIGGER tri_empAdd;</p>
<p>SELECT <em> FROM employee;<br>SELECT </em> FROM emp_log;</p>
<p>INSERT INTO employee(NAME,deptId,bossId) VALUES(‘李七’,5,1);<br>UPDATE employee SET NAME=’张三’ WHERE id=10;<br>DELETE FROM employee WHERE id=10;</p>
<p>– 五、mysql权限问题<br>– root用户： 超级管理员。    权限： 增删改查（数据库，表，数据）<br>– 给mysql数据库分配不同权限的不同用户</p>
<p>– mysql数据库：存放mysql配置信息，包括用户信息<br>USE mysql;<br>– 用户表<br>SELECT * FROM USER;</p>
<p>– 加密函数(md5算法–单向加密)<br>SELECT PASSWORD(‘root’); – *81F5E21E35407D884A6CD4A731AEBFB6AF209E1B</p>
<p>– 修改用户密码<br>UPDATE USER SET PASSWORD=PASSWORD(‘123456’) WHERE USER=’root’;</p>
<p>– 分配权限给不同的用户<br>– 需求： 分配查询day15数据库的employee表的权限给eric用户，密码为‘123456’<br>GRANT SELECT ON day15.employee TO ‘eric‘@’localhost’ IDENTIFIED BY ‘123456’;<br>GRANT DELETE ON day15.employee TO ‘eric‘@’localhost’ IDENTIFIED BY ‘123456’;</p>
<p>SHOW TABLES;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/05/20/ggman/" data-id="cjvw0vsmu00012oao2kbfcean" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2019/05/20/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/05/20/ggman/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/05/20/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Mr Pang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>